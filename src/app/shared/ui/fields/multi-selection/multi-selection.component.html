
<div class="relative">
  <!--  (click)="showFieldDropdown = true; inputField.focus()" -->
  <div [class.border-red-500]="isInvalid"
    [ngClass]="{ 'cursor-not-allowed': isDisabled }"
    class="w-full px-4 py-[0.32rem] border border-gray-300 rounded bg-white focus:outline-none focus:ring-2 focus:ring-[#16c2d5]/20 focus:border-[#16c2d5]">
    <div class="flex flex-wrap gap-2">
      @for (field of selectedField; track field) {
      <div
        class="inline-flex items-center px-2.5 py-0.5 rounded-full text-sm bg-primary/20 text-primary">
        {{field[keyLabel]}}
        <button type="button" class="ml-1.5 hover:text-primary/80"
          (click)="removeField(field)">
          <i class="ri-close-line"></i>
        </button>
      </div>
      }

      <input #inputField
        type="text"
        [(ngModel)]="fieldInput"
        (focus)="showFieldDropdown = true"
        (blur)="onInputBlur()"
        [disabled]="isDisabled" 
        [ngClass]="{ 'cursor-not-allowed': isDisabled }"
        placeholder="Type or select option..."
        class="flex-1 text-sm min-w-[120px] outline-none text-sm">
    </div>
  </div>
  <div
    class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
    <i class="ri ri-arrow-down-s-line text-gray-400"></i>
  </div>

  @if (showFieldDropdown) {
  <div
    class="absolute z-10 w-full mt-1 py-1 bg-white border border-gray-300 rounded-md shadow-lg">
    <div class="max-h-[200px] overflow-y-auto">
      @for (field of filterField(); track field) {
      <div
        class="px-3 py-1 hover:bg-gray-100 cursor-pointer text-sm w-full flex items-center justify-between"
        (mousedown)="addField(field)"
        role="option"
        [attr.aria-selected]="isFieldSelected(field)">
        {{field[keyLabel]}}
        @if (isFieldSelected(field)) {
        <i class="ri-check-line text-primary"></i>
        }
      </div>
      }
      @if (filterField().length === 0) {
      <div class="px-3 py-2 text-sm text-gray-500">
        No Field found
      </div>
      }
    </div>
  </div>
  }
</div>
@if (isInvalid) {
  <small class="text-red-500">
      @for (data of errorList; track $index) {
      @if (data.error) {
      {{data.errorMessage}}
      }
      }
  </small>
  }